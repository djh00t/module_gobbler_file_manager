name: Generate release notes and create GitHub release

on:
  push:
    tags:
      - 'v[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
	checkout:
		runs-on: ubuntu-latest
		steps:
		  - uses: actions/checkout@v3
	
	  build:
		runs-on: ubuntu-latest
		needs: checkout
		steps:
		  - uses: actions/github-script@v6
			with:
			  script: |
				const currentTag = '${{ github.ref }}'
				const previousTag = await github.getPreviousTag()
	
				const changelog = await github.generateReleaseChangelog({
				  fromCommit: previousTag.sha,
				  toCommit: currentTag.sha,
				})
	
				github.outputs.changelog = changelog
	
		  - uses: actions/create-release@v3
			with:
			  tag_name: '${{ github.ref }}'
			  name: '${{ github.ref }}'
			  body: '${{ steps.generate_release_notes.outputs.changelog }}'